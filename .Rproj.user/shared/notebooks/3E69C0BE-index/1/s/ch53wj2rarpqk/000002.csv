"0",""
"0","#Updating table 1"
"0","table_1_word <- table_1 %>%"
"0","  mutate(., current_percentage = current_smoker/total*100,"
"0","         former_percentage = former_smoker/total*100,"
"0","         current_former_percentage = current_former_smoker/total*100,"
"0","         never_smoker_percentage = never_smoker/total*100,"
"0","         never_smoker_unknown_percentage = never_smoker_unknown/total*100,"
"0","         not_stated_percentage = not_stated/total*100,"
"0","         missing_percentage = missing/total*100) %>%"
"0","  select(lead_author, date_published, country, sample_size, median_age, iqr_lower, iqr_upper, mean_age, lower_range,"
"0","         upper_range, standard_deviation, female_sex_percent, current_percentage, former_percentage, current_former_percentage,"
"0","         never_smoker_percentage, never_smoker_unknown_percentage, not_stated_percentage, missing_percentage, study_id) %>%"
"0","  replace_na(., list(not_stated_percentage = 0, missing_percentage = 0)) %>%"
"0","  mutate(., missing_percentage = not_stated_percentage + missing_percentage,"
"0","         missing_percentage = formatC(missing_percentage, digits = 2, format = ""f"")) %>%"
"0","  left_join(., table_6 %>%"
"0","              rename(lead_author = 'author') %>%"
"0","              select(lead_author, ""Overall rating (poor, fair, good)""),"
"0","            by = 'lead_author')"
"0","           "
"0",""
"0","a <- data_study_general %>%"
"0","  select(study_id, study_setting)"
"0",""
"0","table_1_word <- left_join(table_1_word, a, by = 'study_id') %>%"
"0","  select(1:4, 22, 5:20, 21)"
"0","table_1_word$date_published <- as.Date.character(table_1_word$date_published)"
"0","write_rds(table_1_word, here::here('data_clean', 'table_1_word.rds'))"
"0",""
"0","table_1_word <- table_1_word %>%"
"0","  mutate(median_mean = ifelse(is.na(median_age), mean_age, median_age))"
"0",""
"0",""
"0","a <- table_1_word %>%"
"0","  mutate(median_mean = ifelse(is.na(median_age), mean_age, median_age),"
"0","         mean_used = ifelse(is.na(mean_age), '','^'),"
"0","         iqr = ifelse(is.na(iqr_lower), NA, paste(iqr_lower, iqr_upper, sep = '-')),"
"0","         range_combined = paste(lower_range, upper_range, sep = '-'),"
"0","         range_combined = na_if(range_combined, 'NA-NA'),"
"0","         st_dev = paste((as.integer(median_mean-standard_deviation)), as.integer((median_mean+standard_deviation)), sep = '-'),"
"0","         st_dev = na_if(st_dev, 'NA-NA'))"
"0",""
"0","a$iqr <- coalesce(a$iqr, a$range_combined, a$st_dev)"
"0","a$iqr_used <- coalesce(a$range_used, a$st_dev_used)"
"0",""
"0","a <- a %>%"
"0","  select(study_id, lead_author, date_published, country, sample_size, study_setting, median_mean, mean_used, iqr,"
"0","         female_sex_percent, current_percentage, current_former_percentage, never_smoker_percentage,"
"0","         never_smoker_unknown_percentage, missing_percentage, ""Overall rating (poor, fair, good)"") %>%"
"0","  mutate(median_mean = paste(median_mean, mean_used, sep = ''),"
"0","         median_mean = na_if(median_mean, NA)) %>%"
"0","  select(-mean_used) %>%"
"0","  mutate(median_mean = ifelse(median_mean == 'NA', 'NA', paste(paste(median_mean, iqr, sep = ' ('),')', sep = ''))) %>%"
"0","  select(-iqr) %>%"
"0","  rename('Study ID' = study_id,"
"0","         'Lead author' = lead_author,"
"0","         'Date published' = date_published,"
"0","         'Country' = country,"
"0","         'Sample size' = sample_size,"
"0","         'Study setting' = study_setting,"
"0","         'Median (IQR)' = median_mean,"
"0","         'Female %' = female_sex_percent,"
"0","         'Current smoker %' = current_percentage,"
"0","         'Current/former smokers %' = current_former_percentage,"
"0","         'Never smokers %' = never_smoker_percentage,"
"0","         'Never/unknown smokers %' = never_smoker_unknown_percentage,"
"0","         'Missing %' = missing_percentage)"
"0","         "
"0","a$`Lead author` <- to_upper_camel_case(a$`Lead author`, sep_out = "", "")"
"0","a$`Lead author` <- a$`Lead author` %>%"
"0","  recode('Chow, Us, Cdc' = 'Chow (US CDC)',"
"0","         ""Gold, Us, Cdc"" = ""Gold (US CDC)"","
"0","         ""Miyara, Updated"" = ""Miyara"","
"0","         ""De, La, Rica"" = ""de la Rica"","
"0","         ""Opensafely, Collaborative"" = ""The Opensafely Collaborative"","
"0","         ""Bello, Chavolla"" = ""Bello-Chavolla"","
"0","         ""Carrillo, Vega"" = ""Carillo-Vega"","
"0","         ""De, Lusignan"" = ""de Lusignan"","
"0","         ""Mejia, Vilet"" = ""Mejia-Vilet"","
"0","         ""Heili, Frades"" = ""Heili-Frades"","
"0","         ""Vaquero, Roncero"" = ""Vaquero-Roncero"","
"0","         ""Al, Hindawi"" = ""Al-Hindawi"","
"0","         ""Del, Valle"" = ""del Valle"","
"0","         ""Soto, Mota"" = ""Soto-Mota"")"
"0",""
"0","a$`Study setting` <-to_title_case(a$`Study setting`, sep_out = "" "")"
"0","a$`Country` <-to_title_case(a$`Country`, sep_out = "" "")"
"0","a$`Country` <- a$Country %>%"
"0","  recode('Usa' = 'USA',"
"0","         'Uk' = 'UK')"
"0",""
"0","numeric_columns <- c('Median (IQR)', 'Female %', 'Current smoker %', 'Current/former smokers %',"
"0","                     'Never smokers %', 'Never/unknown smokers %', 'Missing %')"
"0",""
"0","datatable(a) %>%"
"0","  formatRound("
"0","    columns = c(4, 8:14),"
"0","    digits = 2,"
"0","    interval = 3,"
"0","    mark = "","","
"0","    dec.mark = getOption(""OutDec"")"
"0",")"
